<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Admin Panel — North Echo</title>

<link rel="stylesheet" href="style.css">
<link rel="stylesheet" href="support.css">
<script src="menu.js" defer></script>
<script src="theme.js" defer></script>

<style>
body { margin:0; padding:0; color:white; }

.admin-wrapper {
  margin-top:130px;
  max-width:1200px;
  margin:auto;
  padding:20px;
}

.msg-box {
  background:#0d0d0d;
  border:1px solid #222;
  border-radius:14px;
  padding:20px;
  margin-bottom:18px;
  position:relative;
}

.msg-img { width:140px; margin-top:10px; border-radius:10px; cursor:pointer; }

.reply-box {
  margin-top:15px;
  background:#111;
  padding:12px;
  border-radius:10px;
  border:1px solid #333;
}

.reply-input {
  width:100%;
  padding:10px;
  background:#0f0f0f;
  border:1px solid #444;
  border-radius:8px;
  color:white;
}

.reply-send {
  margin-top:8px;
  padding:10px;
  width:100%;
  background:#00aa66;
  border:none;
  border-radius:8px;
  cursor:pointer;
  color:white;
}

.reply-send:hover { background:#009655; }

.reply-item {
  background:#101010;
  padding:10px;
  border-radius:8px;
  border:1px solid #333;
  margin-top:8px;
  font-size:14px;
}
</style>

</head>
<body>

<!-- HEADER -->
<header class="header">
  <div class="hamburger" id="menuBtn">☰</div>
  <a href="index.html" class="logo">NORTH ECHO</a>

  <div class="right-buttons">
    <img id="userAvatar" class="avatar" src="assets/default-avatar.png">
    <div class="avatar-menu" id="avatarMenu">
      <a href="profile.html">Profile</a>
      <a href="#" onclick="logout()">Logout</a>
    </div>
  </div>
</header>

<div class="side-menu" id="sideMenu">
  <button id="closeMenu" class="close-menu">×</button>
  <a href="index.html">Home</a>
</div>

<div class="admin-wrapper">
  <h1>Support Messages</h1>
  <div id="adminMessages">Loading...</div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {

  const ADMINS = ["luivoss","lui1907","ahmet","owner","admin"];
  let logged = localStorage.getItem("loggedInUser");
  if (!logged || !ADMINS.includes(logged.toLowerCase()))
      return window.location.href = "index.html";

  let msgs = JSON.parse(localStorage.getItem("supportMessages")) || [];
  const box = document.getElementById("adminMessages");

  if (msgs.length === 0) {
    box.innerHTML = `<p style="opacity:.6;">No support messages yet.</p>`;
    return;
  }

  box.innerHTML = "";

  msgs.forEach((msg, i) => {

    box.innerHTML += `
      <div class="msg-box">

        <h3>${msg.name} (${msg.email})</h3>
        <p>${msg.text}</p>

        ${msg.file ? `<img class="msg-img" src="${msg.file}" onclick="openImg('${msg.file}')">` : ""}

        <div style="opacity:.6; font-size:13px; margin-top:6px;">
          ${msg.date}
        </div>

        <!-- EXISTING ADMIN REPLIES -->
        ${msg.replies?.map(r => 
          `<div class='reply-item'>Admin: ${r.text} <br><span style='opacity:.5;font-size:11px;'>${r.date}</span></div>`
        ).join("") || ""}

        <!-- REPLY BOX -->
        <div class="reply-box">
          <input class="reply-input" id="reply-${i}" placeholder="Write admin reply...">
          <button class="reply-send" onclick="sendReply(${i})">Send Reply</button>
        </div>

      </div>
    `;
  });

});

// SEND REPLY
function sendReply(i) {
  let msgs = JSON.parse(localStorage.getItem("supportMessages")) || [];
  let input = document.getElementById("reply-" + i);

  if (!input.value.trim()) return alert("Please write something.");

  if (!msgs[i].replies) msgs[i].replies = [];

  msgs[i].replies.push({
    text: input.value,
    date: new Date().toLocaleString()
  });

  localStorage.setItem("supportMessages", JSON.stringify(msgs));
  location.reload();
}

// OPEN IMAGE
function openImg(url) {
  let w = window.open();
  w.document.write(`<img src="${url}" style="width:100%;">`);
}

// LOGOUT
function logout() {
  localStorage.removeItem("loggedInUser");
  window.location.href = "login.html";
}
</script>

</body>
</html>
