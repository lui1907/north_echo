<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>My Addresses â€” North Echo</title>

<link rel="stylesheet" href="style.css">
<link rel="stylesheet" href="support.css">

<script src="menu.js" defer></script>
<script src="theme.js" defer></script>
<script src="support.js" defer></script>

<style>
body { color:white; }

.address-wrapper {
  margin-top:130px;
  max-width:700px;
  margin-left:auto;
  margin-right:auto;
}

.address-card {
  background:#0f0f0f;
  border:1px solid #222;
  border-radius:12px;
  padding:18px;
  margin-bottom:12px;
}

.addr-actions {
  margin-top:10px;
  display:flex;
  gap:10px;
}

.addr-actions button {
  padding:6px 12px;
  border:none;
  border-radius:8px;
  cursor:pointer;
}

.set-default { background:#00aa66; color:white; }
.delete-btn { background:#bb0000; color:white; }

.add-box {
  margin-top:25px;
  background:#141414;
  border:1px solid #333;
  border-radius:12px;
  padding:20px;
}

.add-box input {
  width:100%;
  padding:10px;
  margin-bottom:12px;
  background:#111;
  border:1px solid #333;
  border-radius:8px;
  color:white;
}

.add-box button {
  background:white;
  color:black;
  padding:10px;
  width:100%;
  border-radius:8px;
  cursor:pointer;
  font-weight:bold;
}
</style>
</head>

<body>

<!-- HEADER -->
<header class="header">
    <div class="hamburger" id="menuBtn">â˜°</div>
    <a href="index.html" class="logo">NORTH ECHO</a>

    <div class="right-buttons">
      <a href="cart.html" class="cart-icon">ðŸ›’ <span id="cartCount">0</span></a>
      <img src="assets/default-avatar.png" class="avatar" id="userAvatar">
      <div class="avatar-menu" id="avatarMenu">
        <a href="dashboard.html">Dashboard</a>
        <a href="settings.html">Settings</a>
        <a href="profile.html">Profile</a>
        <a href="#" class="logout" onclick="logout()">Logout</a>
      </div>
    </div>
</header>

<div class="address-wrapper">
  <h2>My Addresses</h2>

  <div id="addressList"></div>

  <div class="add-box">
    <h3>Add New Address</h3>

    <input id="add_country" type="text" placeholder="Country">
    <input id="add_city" type="text" placeholder="City">
    <input id="add_full" type="text" placeholder="Full Address">

    <button onclick="addAddress()">Add Address</button>
  </div>
</div>

<script>
const user = localStorage.getItem("loggedInUser");
if (!user) window.location.href = "login.html";

function loadAddresses(){
  const list = JSON.parse(localStorage.getItem("addresses_" + user)) || [];
  const box = document.getElementById("addressList");
  box.innerHTML = "";

  list.forEach((a, i) => {
    box.innerHTML += `
      <div class="address-card">
        <b>${a.country}</b>, ${a.city}<br>
        ${a.full}
        ${a.default ? "<p style='color:#00ff99;font-size:14px;margin-top:8px;'>âœ” Default Address</p>" : ""}
        
        <div class="addr-actions">
          <button class="set-default" onclick="setDefault(${i})">Set Default</button>
          <button class="delete-btn" onclick="deleteAddress(${i})">Delete</button>
        </div>
      </div>
    `;
  });
}

loadAddresses();

/* âž• Add New Address */
function addAddress(){
  let c = add_country.value.trim();
  let ci = add_city.value.trim();
  let f = add_full.value.trim();
  if (!c || !ci || !f) return alert("Fill all fields");

  let list = JSON.parse(localStorage.getItem("addresses_" + user)) || [];

  list.push({
    country: c,
    city: ci,
    full: f,
    default: list.length === 0 ? true : false
  });

  localStorage.setItem("addresses_" + user, JSON.stringify(list));

  loadAddresses();
  add_country.value = "";
  add_city.value = "";
  add_full.value = "";
}

/* ðŸŸ¢ Default Set */
function setDefault(i){
  let list = JSON.parse(localStorage.getItem("addresses_" + user)) || [];
  list.forEach(a => a.default = false);
  list[i].default = true;

  localStorage.setItem("addresses_" + user, JSON.stringify(list));
  loadAddresses();
}

/* âŒ Delete Address */
function deleteAddress(i){
  let list = JSON.parse(localStorage.getItem("addresses_" + user)) || [];
  list.splice(i, 1);

  // eÄŸer default silindiyse ilk adresi default yap
  if (list.length > 0 && !list.some(a => a.default)) {
    list[0].default = true;
  }

  localStorage.setItem("addresses_" + user, JSON.stringify(list));
  loadAddresses();
}
</script>

</body>
</html>
