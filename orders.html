<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>

<title>My Orders â€” North Echo</title>

<link rel="stylesheet" href="style.css">
<link rel="stylesheet" href="support.css">

<script src="menu.js" defer></script>
<script src="theme.js" defer></script>
<script src="support.js" defer></script>

<style>
body { color:white;margin:0;padding:0;background:black; }

.orders-wrapper {
  margin-top:130px;
  display:flex;
  justify-content:center;
  padding:20px;
}

.orders-card {
  width:750px;
  background:#0d0d0d;
  border:1px solid #222;
  border-radius:18px;
  padding:25px;
}

.order-box {
  background:#141414;
  border:1px solid #333;
  border-radius:12px;
  padding:15px;
  margin-bottom:18px;
  cursor:pointer;
}

.order-header { font-size:17px;font-weight:bold;margin-bottom:6px; }
.order-status { color:#00aa66;font-size:14px;margin-bottom:5px; }
.order-date { opacity:0.8;font-size:14px;margin-bottom:10px; }

.no-orders {
  text-align:center;
  margin-top:40px;
  font-size:16px;
  opacity:0.7;
}

.order-total {
  margin-top:8px;
  font-weight:bold;
}
</style>
</head>

<body>

<!-- HEADER -->
<header class="header">
  <div class="hamburger" id="menuBtn">â˜°</div>
  <a href="index.html" class="logo">NORTH ECHO</a>
  <div class="right-buttons">
    <a href="cart.html" class="cart-icon">ðŸ›’ <span id="cartCount">0</span></a>
    <img src="assets/default-avatar.png" class="avatar" id="userAvatar">
    <div class="avatar-menu" id="avatarMenu">
      <a href="profile.html">Profile</a>
      <a href="settings.html">Settings</a>
      <a href="#" class="logout" onclick="logout()">Logout</a>
    </div>
  </div>
</header>

<!-- SIDE MENU -->
<div class="side-menu" id="sideMenu">
  <button id="closeMenu" class="close-menu">Ã—</button>
  <a href="index.html">Home</a>
  <a href="tshirts.html">T-Shirts</a>
  <a href="sweatshirts.html">Sweatshirts</a>
  <a href="hoodies.html">Hoodies</a>
  <a href="cart.html">Cart</a>
</div>

<div class="orders-wrapper">
  <div class="orders-card">
    <h2>My Orders</h2>
    <div id="ordersList"></div>
  </div>
</div>

<!-- LOAD ORDERS FROM SUPABASE -->
<script type="module">
import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

const supabase = createClient(
  "https://xedfviwffpsvbmyqzoof.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhlZGZ2aXdmZnBzdmJteXF6b29mIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMxMjM0NzMsImV4cCI6MjA3ODY5OTQ3M30.SK7mEei8GTfUWWPPi4PZjxQzDl68yHsOgQMgYIHunaM"
);

const username = localStorage.getItem("loggedInUser");
if (!username) window.location.href = "login.html";

const list = document.getElementById("ordersList");

/* Ordersâ€™Ä± Ã§ek (supabase orders tablosu) */
const { data: orders } = await supabase
  .from("orders")
  .select("*")
  .eq("username", username)
  .order("id", { ascending: false });

if (!orders || orders.length === 0) {
  list.innerHTML = `<p class="no-orders">You have no orders yet.</p>`;
} else {
  orders.forEach(o => {
    list.innerHTML += `
      <div class="order-box" onclick="window.location='order-detail.html?id=${o.id}'">
        <div class="order-header">Order #${o.id}</div>
        <div class="order-status">${o.status}</div>
        <div class="order-date">${o.date}</div>
        <div class="order-total">Total: ${o.total}â‚¬</div>
      </div>
    `;
  });
}
</script>

<!-- PROFILE MENU -->
<script>
document.getElementById("userAvatar").onclick = () => {
  avatarMenu.style.display = avatarMenu.style.display === "flex" ? "none":"flex";
};
function logout(){
  localStorage.removeItem("loggedInUser");
  window.location.href="login.html";
}
</script>

<!-- SUPPORT BUTTON -->
<div id="supportBtn"><img src="assets/support.svg"></div>
<div id="supportPanel"> â€¦ </div> <!-- support.js hepsini kendisi dolduruyor -->

<script src="support.js"></script>

<!-- CART COUNT -->
<script>
document.addEventListener("DOMContentLoaded", ()=>{
  const cart = JSON.parse(localStorage.getItem("cart")) || [];
  cartCount.textContent = cart.reduce((s,i)=>s+i.quantity,0);
});
</script>

</body>
</html>
