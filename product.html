<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Product â€” North Echo</title>

<link rel="stylesheet" href="style.css" />
<link rel="stylesheet" href="support.css" />
<script src="menu.js" defer></script>
<script src="theme.js" defer></script>
<script src="cart.js" defer></script>
<script src="support.js" defer></script>

<style>
body { background: #000; color: white; font-family: "Inter", sans-serif; }
.product-container { display: flex; justify-content: center; align-items: flex-start; gap: 70px; padding: 70px 10%; }
.product-left img { width: 400px; height: auto; border-radius: 10px; }
.thumb-list { display: flex; gap: 10px; margin-top: 12px; }
.thumb-list img { width: 80px; height: 80px; border-radius: 6px; object-fit: cover; cursor: pointer; transition: 0.2s; }
.thumb-list img:hover { transform: scale(1.05); }

.product-right { max-width: 420px; }
.product-right h1 { font-size: 26px; margin-bottom: 5px; }
.product-right .price { color: #00ff99; font-size: 18px; margin-bottom: 12px; }
.product-right p { color: #ccc; font-size: 14px; margin-bottom: 15px; }

.size-box { margin-bottom: 20px; }
.size-options { display: flex; gap: 10px; }
.size-btn {
  background: #111;
  border: 1px solid #333;
  color: #fff;
  padding: 8px 14px;
  border-radius: 6px;
  cursor: pointer;
  transition: 0.2s;
}
.size-btn.active {
  background: #00aa66;
  border-color: #00ff99;
}
.add-cart-btn {
  width: 100%;
  background: #00aa66;
  color: white;
  font-weight: bold;
  border: none;
  border-radius: 8px;
  padding: 12px 0;
  cursor: pointer;
  transition: 0.2s;
}
.add-cart-btn:hover { background: #00cc77; }

.recommended-box {
  margin: 60px auto;
  max-width: 1000px;
  border-top: 1px solid #111;
  padding-top: 30px;
}
.recommended-box h2 { margin-bottom: 20px; color: #fff; }
.rec-grid { display: flex; gap: 20px; flex-wrap: wrap; }
.rec-card {
  background: #0f0f0f;
  border: 1px solid #222;
  border-radius: 10px;
  width: 200px;
  overflow: hidden;
  text-decoration: none;
  color: #fff;
  transition: 0.2s;
}
.rec-card:hover { transform: translateY(-4px); border-color: #00aa66; }
.rec-card img { width: 100%; height: 180px; object-fit: cover; }
.rec-card h3 { text-align: center; font-size: 14px; padding: 10px 0; }

.toast {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%) scale(0.9);
  background: rgba(20,20,20,0.95);
  border: 1px solid #333;
  padding: 16px 22px;
  color: white;
  border-radius: 10px;
  opacity: 0;
  transition: all .3s;
  z-index: 99999;
  font-size: 15px;
}
.toast.show { opacity: 1; transform: translate(-50%,-50%) scale(1); }
.toast.success { border-color:#00aa66; color:#00ff99; }

#supportBtn {
  position: fixed;
  bottom: 25px;
  left: 25px;
  width: 50px;
  height: 50px;
  background: #00aa66;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  z-index: 10000;
  transition: 0.3s;
}
#supportBtn:hover { background: #00cc77; }
#supportBtn img { width: 25px; height: 25px; }
</style>
</head>

<body>

<header class="header">
  <div class="hamburger" id="menuBtn">â˜°</div>
  <a href="index.html" class="logo">NORTH ECHO</a>
  <div class="right-buttons">
    <a href="submit-design.html" class="submit-nav">Submit</a>
    <a href="cart.html" class="cart-icon">ðŸ›’ <span id="cartCount">0</span></a>
    <img src="assets/default-avatar.png" class="avatar" id="userAvatar">
  </div>
</header>

<div class="product-container">
  <div class="product-left">
    <img id="mainImage" src="assets/noimg.png">
    <div class="thumb-list" id="thumbList"></div>
  </div>

  <div class="product-right">
    <h1 id="productName">Loading...</h1>
    <p class="price" id="productPrice"></p>
    <p id="productDesc"></p>

    <div class="size-box">
      <label>Size</label>
      <div class="size-options">
        <div class="size-btn" data-size="S">S</div>
        <div class="size-btn" data-size="M">M</div>
        <div class="size-btn" data-size="L">L</div>
        <div class="size-btn" data-size="XL">XL</div>
      </div>
    </div>

    <button class="add-cart-btn" id="addCartBtn">Add to Cart</button>
  </div>
</div>

<section class="recommended-box">
  <h2>You May Also Like</h2>
  <div class="rec-grid" id="recGrid"></div>
</section>

<!-- SUPPORT BUTTON -->
<div id="supportBtn" onclick="toggleSupportPanel()">
  <img src="data:image/svg+xml;base64,PHN2ZyBmaWxsPSJ3aGl0ZSIgdmlld0JveD0iMCAwIDI0IDI0IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxnPjxwYXRoIGQ9Ik0xMiAyQzYuNDggMiAyIDYuMDggMiAxMS4yNXY5LjI1YzAgMS4yOSAxLjA0IDIuNSAyLjUgMi41aDMuNXYzLjI1YzAgLjQyLjUyLjYzLjgzLjMzTDExLjY3IDIzaDQuODNjNS41MiAwIDEwLTQuMDggMTAtOS4yNVMxNy41MiAyIDEyIDJ6bTAgMkMxNi40MiA0IDIwIDcuMDggMjAgMTEuMjVzLTMuNTggNy4yNS04IDcuMjVoLTUuMTdsLTIuNjcgMi42N1YxOC40N0g0Yy0yLjIxIDAtNC0xLjc5LTQtNC4wNlYxMS4yNUM0IDcuMDggNy41OCA0IDEyIDR6Ii8+PC9nPjwvc3ZnPg==" alt="Support">
</div>
<div id="supportPanel"></div>

<script type="module">
import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

const supabase = createClient("https://xedfviwffpsvbmyqzoof.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhlZGZ2aXdmZnBzdmJteXF6b29mIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMxMjM0NzMsImV4cCI6MjA3ODY5OTQ3M30.SK7mEei8GTfUWWPPi4PZjxQzDl68yHsOgQMgYIHunaM");

const params = new URLSearchParams(window.location.search);
const id = params.get("id");

const mainImage = document.getElementById("mainImage");
const thumbList = document.getElementById("thumbList");
const nameEl = document.getElementById("productName");
const priceEl = document.getElementById("productPrice");
const descEl = document.getElementById("productDesc");
const recGrid = document.getElementById("recGrid");

async function loadProduct() {
  const { data, error } = await supabase.from("products").select("*").eq("id", id).single();
  if (error || !data) {
    document.body.innerHTML = "<h2 style='color:red;text-align:center'>Product not found</h2>";
    return;
  }

  nameEl.textContent = data.name;
  priceEl.textContent = data.price + "â‚¬";
  descEl.textContent = data.description || "";

  const imgs = (data.images || "").split(",");
  mainImage.src = imgs[0] || "assets/noimg.png";
  thumbList.innerHTML = imgs.map(img => `<img src="${img}" onclick="document.getElementById('mainImage').src='${img}'">`).join("");

  loadRecommendations(data.category);
}

async function loadRecommendations(category) {
  const { data, error } = await supabase.from("products").select("*").neq("id", id).eq("category", category).limit(3);
  if (error) return;
  recGrid.innerHTML = data.map(p => `
    <a href="product.html?id=${p.id}" class="rec-card">
      <img src="${(p.images||'').split(',')[0]}" alt="${p.name}">
      <h3>${p.name}</h3>
    </a>
  `).join("");
}
loadProduct();

// SIZE SEÃ‡Ä°MÄ°
let selectedSize = null;
document.querySelectorAll(".size-btn").forEach(btn => {
  btn.addEventListener("click", () => {
    document.querySelectorAll(".size-btn").forEach(b => b.classList.remove("active"));
    btn.classList.add("active");
    selectedSize = btn.dataset.size;
  });
});

// ADD TO CART
document.getElementById("addCartBtn").addEventListener("click", () => {
  if (!selectedSize) return showToast("Please select a size âŒ", "error");

  const product = {
    id,
    name: nameEl.textContent,
    price: priceEl.textContent,
    image: mainImage.src,
    size: selectedSize,
    quantity: 1
  };

  let cart = JSON.parse(localStorage.getItem("cart")) || [];
  cart.push(product);
  localStorage.setItem("cart", JSON.stringify(cart));

  showToast(`${product.name} (${selectedSize}) added to cart ðŸ›’`, "success");
});

function showToast(msg, type = "info") {
  let toast = document.createElement("div");
  toast.className = `toast ${type}`;
  toast.textContent = msg;
  document.body.appendChild(toast);
  setTimeout(() => toast.classList.add("show"), 100);
  setTimeout(() => {
    toast.classList.remove("show");
    setTimeout(() => toast.remove(), 400);
  }, 2500);
}
</script>

</body>
</html>
